%%{init: {'theme': 'neutral', 'themeVariables': { 'primaryColor': '#ffffff', 'primaryTextColor': '#000000', 'primaryBorderColor': '#000000', 'lineColor': '#000000', 'secondaryColor': '#f8f8f8', 'tertiaryColor': '#ffffff'}}}%%

flowchart TD
    %% Main Components with clean, black and white aesthetic
    Client(["ğŸ‘¤ Client Browser"]) --> Frontend("ğŸ“± Frontend React App")
    Frontend --> Router("ğŸ§­ React Router")
    Frontend --> ContextProviders("ğŸ”„ Context Providers")
    Frontend <--> APIClient("ğŸ”Œ API Client")
    APIClient <--> ExpressServer("âš™ï¸ Express Server")
    ExpressServer <--> Controllers("ğŸ® Controllers")
    Controllers <--> Services("ğŸ› ï¸ Services")
    Controllers <--> OpenAI("ğŸ§  OpenAI API")
    APIClient <--> Supabase("ğŸ’¾ Supabase")
    
    %% Frontend Layer - Clean, modern organization
    subgraph "Frontend Layer"
        direction TB
        Router --> Views("ğŸ“„ Views")
        Router --> Components("ğŸ§© UI Components")
        Views --> Components
        
        subgraph "State Management"
            direction LR
            ContextProviders --> AuthContext("ğŸ” Auth Context")
            ContextProviders --> ProjectContext("ğŸ“‹ Project Context")
            ContextProviders --> TaskContext("âœ… Task Context")
        end
        
        subgraph "Component Structure"
            direction LR
            Components --> Pages("ğŸ“‘ Pages")
            Components --> Common("ğŸ”„ Common Components")
            Components --> Form("ğŸ“ Form Components")
        end
    end
    
    %% Backend Layer - Clear separation of concerns
    subgraph "Backend Layer"
        direction TB
        ExpressServer --> ApiRoutes("ğŸ›£ï¸ API Routes")
        
        subgraph "Controller Layer"
            direction LR
            ApiRoutes --> RoleController("ğŸ‘¥ Role Controller")
            ApiRoutes --> TaskController("ğŸ“‹ Task Controller")
        end
        
        subgraph "Service Layer"
            direction LR
            RoleController --> RoleService("ğŸ‘¥ Role Service")
            TaskController --> TaskService("ğŸ“‹ Task Service")
            RoleService --> OpenAI
            TaskService --> OpenAI
        end
    end
    
    %% Data Layer - Clean database structure
    subgraph "Data Layer"
        direction TB
        Supabase --> Auth("ğŸ”‘ Authentication")
        Supabase --> Database("ğŸ—„ï¸ PostgreSQL Database")
        
        subgraph "Database Tables"
            direction TB
            Database --> Projects("ğŸ“‚ Projects")
            Database --> Tasks("âœ… Tasks")
            Database --> Roles("ğŸ‘¥ Roles")
            Database --> Users("ğŸ‘¤ Users")
            Database --> Conversations("ğŸ’¬ Conversations")
            Database --> ProjectPlans("ğŸ“Š Project Plans")
        end
    end
    
    %% API Endpoints - Modern, organized structure
    subgraph "API Endpoints"
        direction TB
        ApiRoutes --> HealthCheck["/api/health"]
        ApiRoutes --> ExtractRole["/api/extract-role-info"]
        ApiRoutes --> Conversation["/api/conversation"]
        ApiRoutes --> CreateTasks["/api/create-tasks"]
        ApiRoutes --> GenSuggestions["/api/generate-suggestions"]
        ApiRoutes --> GenProjectPlan["/api/generate-project-plan"]
        ApiRoutes --> ConvertPlanToTasks["/api/convert-plan-to-tasks"]
        ApiRoutes --> GenFinalPlan["/api/generate-final-plan"]
        ApiRoutes --> GetProjectContext["/api/get-project-context"]
        ApiRoutes --> EditMarkdown["/api/edit-markdown-section"]
    end
    
    %% User Flow - Clean, numbered steps
    Client --> |"1. Auth"|Auth
    Client --> |"2. Projects"|Projects
    Client --> |"3. Tasks"|Tasks
    Client --> |"4. Role Info"|ExtractRole
    Client --> |"5. Planning"|Conversation
    Client --> |"6. Project Plan"|GenProjectPlan
    
    %% Application Flow
    ExtractRole --> |"AI Processing"|OpenAI
    Conversation --> |"AI Processing"|OpenAI
    GenProjectPlan --> |"AI Processing"|OpenAI
    
    %% Modern, clean styling
    classDef primary fill:#000000,stroke:#000000,stroke-width:2px,color:#ffffff,font-weight:bold
    classDef secondary fill:#ffffff,stroke:#000000,stroke-width:1px,color:#000000
    classDef tertiary fill:#f8f8f8,stroke:#000000,stroke-width:1px,color:#000000
    classDef emphasis fill:#ffffff,stroke:#000000,stroke-width:3px,color:#000000,font-weight:bold
    
    class Client,Frontend,ExpressServer,Supabase,OpenAI primary
    class Router,APIClient,Controllers,Services,Database secondary
    class Views,Components,ApiRoutes,ContextProviders tertiary
    class Auth,Projects,Tasks,Conversation emphasis
